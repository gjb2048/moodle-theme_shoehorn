define(["jquery","core/log"],function(a,b){"use strict";b.debug("Shoehorn backstretch AMD jQuery initialised"),a.fn.backstretch=function(b,c){return(void 0===b||0===b.length)&&a.error("No images were supplied for Backstretch"),0===a(window).scrollTop()&&window.scrollTo(0,0),this.each(function(){var e=a(this),f=e.data("backstretch");if(f){if("string"==typeof b&&"function"==typeof f[b])return void f[b](c);c=a.extend(f.options,c),f.destroy(!0)}f=new d(this,b,c),e.data("backstretch",f)})},a.backstretch=function(b,c){return a("body").backstretch(b,c).data("backstretch")},a.expr[":"].backstretch=function(b){return void 0!==a(b).data("backstretch")},a.fn.backstretch.defaults={centeredX:!0,centeredY:!0,duration:5e3,fade:0};var c={wrap:{left:0,top:0,overflow:"hidden",margin:0,padding:0,height:"100%",width:"100%",zIndex:-999999},img:{position:"absolute",display:"none",margin:0,padding:0,border:"none",width:"auto",height:"auto",maxHeight:"none",maxWidth:"none",zIndex:-999999}},d=function(b,d,f){this.options=a.extend({},a.fn.backstretch.defaults,f||{}),this.images=a.isArray(d)?d:[d],a.each(this.images,function(){a("<img />")[0].src=this}),this.isBody=b===document.body,this.$container=a(b),this.$root=this.isBody?a(e?window:document):this.$container;var g=this.$container.children(".backstretch").first();if(this.$wrap=g.length?g:a('<div class="backstretch"></div>').css(c.wrap).appendTo(this.$container),!this.isBody){var h=this.$container.css("position"),i=this.$container.css("zIndex");this.$container.css({position:"static"===h?"relative":h,zIndex:"auto"===i?0:i,background:"none"}),this.$wrap.css({zIndex:-999998})}this.$wrap.css({position:this.isBody&&e?"fixed":"absolute"}),this.index=0,this.show(this.index),a(window).on("resize.backstretch",a.proxy(this.resize,this)).on("orientationchange.backstretch",a.proxy(function(){this.isBody&&0===window.pageYOffset&&(window.scrollTo(0,1),this.resize())},this))};d.prototype={resize:function(){try{var a,b={left:0,top:0},c=this.isBody?this.$root.width():this.$root.innerWidth(),d=c,e=this.isBody?window.innerHeight?window.innerHeight:this.$root.height():this.$root.innerHeight(),f=d/this.$img.data("ratio");f>=e?(a=(f-e)/2,this.options.centeredY&&(b.top="-"+a+"px")):(f=e,d=f*this.$img.data("ratio"),a=(d-c)/2,this.options.centeredX&&(b.left="-"+a+"px")),this.$wrap.css({width:c,height:e}).find("img:not(.deleteable)").css({width:d,height:f}).css(b)}catch(g){}return this},show:function(b){if(!(Math.abs(b)>this.images.length-1)){var d=this,e=d.$wrap.find("img").addClass("deleteable"),f={relatedTarget:d.$container[0]};return d.$container.trigger(a.Event("backstretch.before",f),[d,b]),this.index=b,clearInterval(d.interval),d.$img=a("<img />").css(c.img).bind("load",function(c){var g=this.width||a(c.target).width(),h=this.height||a(c.target).height();a(this).data("ratio",g/h),a(this).fadeIn(d.options.speed||d.options.fade,function(){e.remove(),d.paused||d.cycle(),a(["after","show"]).each(function(){d.$container.trigger(a.Event("backstretch."+this,f),[d,b])})}),d.resize()}).appendTo(d.$wrap),d.$img.attr("src",d.images[b]),d}},next:function(){return this.show(this.index<this.images.length-1?this.index+1:0)},prev:function(){return this.show(0===this.index?this.images.length-1:this.index-1)},pause:function(){return this.paused=!0,this},resume:function(){return this.paused=!1,this.next(),this},cycle:function(){return this.images.length>1&&(clearInterval(this.interval),this.interval=setInterval(a.proxy(function(){this.paused||this.next()},this),this.options.duration)),this},destroy:function(b){a(window).off("resize.backstretch orientationchange.backstretch"),clearInterval(this.interval),b||this.$wrap.remove(),this.$container.removeData("backstretch")}};var e=function(){var a=navigator.userAgent,b=navigator.platform,c=a.match(/AppleWebKit\/([0-9]+)/),d=!!c&&c[1],e=a.match(/Fennec\/([0-9]+)/),f=!!e&&e[1],g=a.match(/Opera Mobi\/([0-9]+)/),h=!!g&&g[1],i=a.match(/MSIE ([0-9]+)/),j=!!i&&i[1];return!((b.indexOf("iPhone")>-1||b.indexOf("iPad")>-1||b.indexOf("iPod")>-1)&&d&&534>d||window.operamini&&"[object OperaMini]"==={}.toString.call(window.operamini)||g&&7458>h||a.indexOf("Android")>-1&&d&&533>d||f&&6>f||"palmGetResource"in window&&d&&534>d||a.indexOf("MeeGo")>-1&&a.indexOf("NokiaBrowser/8.5.0")>-1||j&&6>=j)}();return{init:function(c){b.debug("Shoehorn backstretch AMD jQuery init initialised"),b.debug(c),a(document).ready(function(){a.backstretch(c.images,{duration:c.duration,fade:c.fade})})}}});